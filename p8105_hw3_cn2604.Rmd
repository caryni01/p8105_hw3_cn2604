---
title: "p8105_hw3_cn2604"
output: github_document
date: "2022-10-07"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
```{r load_library, echo=FALSE, message=FALSE}
library(tidyverse)
library(p8105.datasets)
library(patchwork)
library(ggridges)
```

# Problem 2
```{r clean_file_1, echo=FALSE, message=FALSE}
acce_df = read.csv("./data/accel_data.csv") %>% 
  janitor::clean_names() %>% 
  pivot_longer(
    activity_1:activity_1440,
    names_to = "activity_number",
    names_prefix = "activity_",
    values_to = "activity_counts"
  ) %>% 
  mutate(
    activity_number = as.numeric(activity_number),
    week_type = factor(case_when(
      day %in% c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday") ~ "weekday",
      day %in% c("Saturday", "Sunday") ~ "weekend",
      TRUE ~ "unknown"
      )
    ),
    .after = day
  )

day_df = acce_df %>% 
  group_by(week, day) %>% 
  summarize(
    total_activity = as.integer(sum(activity_counts))
  )

```
The dataframe after cleaning processes has `r ncol(acce_df)` variables and `r nrow(acce_df)` observations. It includes the week and day variables with an indication of either weekday or weekend. Each one minute interval is turned into a variable named activity_number and activity_counts is the new variable for original activity data.

```{r show_table, echo=FALSE, message=FALSE}
knitr::kable(day_df)
ggplot(day_df, aes(x = day, y = total_activity, fill = week)) +
  geom_bar(stat = "identity") +
  labs(
    title = "Heart activity by week type",
    x = "Day of the week",
    y = "Total activity",
    caption = "Data from P8105 HW3")
```
No apparent trend could be found by the table but the bar plot above suggests that Saturday has least total activity compared to other days of the week.

```{r plot_heart_activity, echo=FALSE, message=FALSE}
acce_df %>% 
  ggplot(aes(x=activity_number, y=activity_counts, color = day)) + 
  geom_point(alpha = .5) + 
  scale_x_continuous(
    breaks = seq(0, 1440, 120),
    labels = c("0", "2:00", "4:00", "6:00","8:00","10:00", "12:00", "14:00", "16:00", "18:00", "20:00", "22:00", "24:00")
  ) +
  scale_color_hue(name = "Day of the week", h = c(300, 0)) +
  labs(
    title = "Heart activity plot",
    x = "Hours of a day",
    y = "Number of activity counts",
    caption = "Data from P8105 HW3")
```
The graph shows that the heart activity rates are highest between 10am to 12pm and 8pm to 10pm throughout the week. The patient seems to have more stable heart activity in Tuesday and Wednesday though he has reached his highest activity rate in Wednesday, which exceeds 7500 activity counts per minute. Overall, the patient maintains an activity rate way below 2500 per minute in most time of a day. 

# Problem 3
```{r load_file_2, echo=FALSE, message=FALSE}
data("ny_noaa")
```
The raw dataframe of ny_noaa has `r ncol(ny_noaa)` variables and `r nrow(ny_noaa)` observations. It has weather station id, date of observation, precipitation, snowfall, snow depth, and maximum and minimum temperatures. For data of precipitation, snowfall, and snow depth, there are `r sum(is.na(ny_noaa$prcp))`, `r sum(is.na(ny_noaa$snow))`, `r sum(is.na(ny_noaa$snwd))` missing values. For tmax and tmin, `r sum(is.na(ny_noaa$tmax))` and `r sum(is.na(ny_noaa$tmin))` of the observations are missing, which loss about a half of helpful information for further analysis. 
```{r clean_file_2, echo=FALSE, message=FALSE}
noaa_df = ny_noaa %>% 
  separate(date, into = c("year", "month", "day"), sep = '-') %>% 
  rename(c("prcp_mm" = "prcp", "snow_mm" = "snow", "snwd_mm" = "snwd")) %>% 
  mutate(
    tmax = as.numeric(tmax),
    tmin = as.numeric(tmin)
  )

clean_snow = na.omit(noaa_df$snow_mm)
find_mode = function(v) {
 uniqv = unique(v)
 uniqv[which.max(tabulate(match(v, uniqv)))]
}

```
1. While most of the observations for snowfall are missing, `r find_mode(clean_snow)` mm is the most commonly seen value in the remaining observation. It is reasonable because snowfall is an occasional event in that area and no snow should be observed in normal days.
```{r df_for_plot, echo=FALSE, message=FALSE}
jan_tmax = noaa_df %>% 
  filter( month == "01") %>% 
  select(id, year, tmax) %>% 
  na.omit() %>% 
  mutate(
    year = as.numeric(year)
    ) %>%
  group_by(id, year) %>% 
  summarize(
    mean_tmax_jan = mean(tmax)
  )

july_tmax = noaa_df %>% 
  filter( month == "07") %>% 
  select(id, year, tmax) %>% 
  na.omit() %>% 
  mutate(
    year = as.numeric(year)
    ) %>% 
  group_by(id, year) %>% 
  summarize(
    mean_tmax_july = mean(tmax)
  )

```
```{r plots, echo=FALSE, message=FALSE}
jan_tmax_p = 
  jan_tmax %>% 
  ggplot(aes(x=id, y=mean_tmax_jan)) + 
  geom_point(aes(color = year))  + 
  scale_colour_gradient(low = 'white', high = 'blue') +
  labs(
    title = "Maximum temperature in Jan",
    x = "Weather station id",
    y = "Temperature degree (°C)",
    caption = "Data from P8105 datasets")

july_tmax_p = 
  july_tmax %>% 
  ggplot(aes(x=id, y=mean_tmax_july)) + 
  geom_point(aes(color = year))  + 
  scale_colour_gradient(low = 'white', high = 'red') +
  labs(
    title = "Maximum temperature in July",
    x = "Weather station id",
    y = "Temperature degree (°C)",
    caption = "Data from P8105 datasets")

jan_tmax_p + july_tmax_p
```
The scatterplots for maximum temperatures shows that most of the observed maximum temperature in January across all weather station is between -50 to 50 degree Celsius while the range is between 250 to 300 degree Celsius in July. Though outliers are hard to be visualized by the scatterplots above, they can be found by the boxplots in the below marked in blue and red.

```{r boxplots, echo=FALSE, message=FALSE}
jan_tmax_box = 
  jan_tmax %>% 
  ggplot(aes(x=id, y=mean_tmax_jan)) +
  geom_boxplot(outlier.colour = "blue") 

july_tmax_box =
  july_tmax %>% 
  ggplot(aes(x=id, y=mean_tmax_july)) +
  geom_boxplot(outlier.colour = "red") 

jan_tmax_box + july_tmax_box
```


